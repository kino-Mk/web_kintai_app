<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>勤怠管理システム</title>
    <link rel="icon" href="images/icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/history.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>

<body>

    <div id="app">
        <!-- ナビゲーション / ヘッダー -->
        <header class="app-header">
            <h1>勤怠管理</h1>
            <button id="nav-back-btn" class="hidden">戻る</button>
        </header>

        <!-- 画面: 従業員選択 (ホーム) -->
        <section id="screen-employee-selection" class="screen active">
            <h2>従業員選択</h2>
            <div id="employee-list" class="list-group">
                <!-- 従業員ボタンがここに注入されます -->
                <p class="loading-text">読み込み中...</p>
            </div>

            <div class="history-section">
                <h3>本日の打刻状況 (全体)</h3>
                <ul id="today-history-list-all" class="history-list"></ul>
            </div>
            <!-- Admin button removed for URL-based access -->
        </section>

        <!-- 画面: 管理者メニュー (ダッシュボード) -->
        <section id="screen-admin" class="screen hidden">
            <h2>管理者メニュー</h2>
            <div class="menu-grid">
                <button class="btn-large btn-primary" onclick="showScreen('admin-employees')">従業員管理 & データ出力</button>
                <button class="btn-large btn-warning" onclick="showScreen('admin-pending')">未処理の申請</button>
                <button class="btn-large btn-success" onclick="showScreen('admin-completed')">処理済みの申請</button>
            </div>
        </section>

        <!-- 画面: 従業員管理 & CSV -->
        <section id="screen-admin-employees" class="screen hidden">
            <div class="screen-header">
                <h2>従業員管理</h2>
                <button class="btn-secondary small" onclick="showScreen('admin')">戻る</button>
            </div>

            <div class="card">
                <h3>従業員登録</h3>
                <input type="text" id="admin-emp-id" placeholder="従業員ID" />
                <input type="text" id="admin-emp-name" placeholder="氏名" />
                <button id="btn-add-employee" class="btn-primary">登録</button>
            </div>

            <div class="card">
                <h3>従業員一覧</h3>
                <ul id="admin-employee-list-view">
                    <!-- リスト -->
                </ul>
            </div>

            <div class="card">
                <h3>データ出力</h3>
                <button id="btn-export-csv" class="btn-action">打刻データCSV出力</button>
                <button id="btn-export-monthly-csv" class="btn-action">月次勤怠CSV出力</button>
            </div>
        </section>

        <!-- 画面: 未処理申請 -->
        <section id="screen-admin-pending" class="screen hidden">
            <div class="screen-header">
                <h2>未処理申請 (Pending)</h2>
                <button class="btn-secondary small" onclick="showScreen('admin')">戻る</button>
            </div>
            <div id="admin-pending-list">
                <p class="loading-text">読み込み中...</p>
            </div>
        </section>

        <!-- 画面: 処理済み申請 -->
        <section id="screen-admin-completed" class="screen hidden">
            <div class="screen-header">
                <h2>処理済み申請 (Completed)</h2>
                <button class="btn-secondary small" onclick="showScreen('admin')">戻る</button>
            </div>
            <div class="filters" style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="month" id="filter-month" style="padding: 5px;">
                <select id="filter-employee" style="padding: 5px;">
                    <option value="">全ての従業員</option>
                </select>
                <button id="btn-filter-apply" class="btn-secondary" style="padding: 5px 10px;">検索</button>
            </div>
            <div id="admin-completed-list">
                <p>検索条件を指定してください</p>
            </div>
        </section>

        <!-- 画面: 打刻 (出勤/退勤) -->
        <section id="screen-time-stamp" class="screen hidden">
            <h2 id="ts-employee-name">従業員名</h2>

            <div class="split-view">
                <div class="main-content">
                    <div class="timestamp-actions">
                        <button id="btn-clock-in" class="btn-large btn-clock-in">出勤</button>
                        <button id="btn-clock-out" class="btn-large btn-clock-out">退勤</button>
                    </div>
                    <div class="navigation-links">
                        <button id="btn-go-application" class="btn-secondary">勤怠申請へ</button>
                    </div>
                </div>

                <div class="side-content">
                    <div class="history-section">
                        <h3>本日の打刻履歴</h3>
                        <ul id="today-history-list-personal" class="history-list"></ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 画面: 勤怠申請 -->
        <section id="screen-application" class="screen hidden">
            <h2 id="app-employee-name">申請画面</h2>
            <div id="application-balance-info" style="margin-bottom: 15px; font-weight: bold; color: #007bff;">
                <!-- 有給残日数がここに表示されます -->
            </div>
            <div class="application-form">
                <label>申請種別</label>
                <select id="application-type">
                    <option value="有給">有給 (全休)</option>
                    <option value="半休">有給 (半休)</option>
                    <option value="欠勤">欠勤</option>
                    <option value="遅刻">遅刻</option>
                    <option value="早退">早退</option>
                    <option value="残業">残業</option>
                </select>

                <label>日付</label>
                <input type="date" id="application-date" required>

                <label>備考 (任意)</label>
                <textarea id="application-reason" rows="3"></textarea>

                <button id="btn-submit-application" class="btn-primary">申請する</button>
            </div>
        </section>
    </div>

    <!-- スクリプト -->
    <script src="js/firebase-config.js"></script>
    <script src="js/app.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/attendance.js"></script>
    <script>
        // PWA Service Worker 登録
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW Registered', reg))
                .catch(err => console.log('SW Registration Failed', err));
        }
    </script>
</body>

</html>